<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terimbere</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            max-width: 100%;
            z-index: 1000;
        }
        .chatbot-header {
            background-color: #3daa3d;
            color: white;
            padding: 10px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            cursor: pointer;
        }
        .chatbot-body {
            background-color: white;
            border: 1px solid #ccc;
            border-top: none;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            display: none;
        }
        .chatbox .messages {
            height: 300px;
            overflow-y: scroll;
            padding: 10px;
        }
        .message {
            margin-bottom: 10px;
        }
        .message.user {
            text-align: right;
        }
        .message.user .message-content {
            background-color: #3daa3d;
            color: white;
        }
        .message.bot .message-content {
            background-color: #e9ecef;
            color: black;
        }
        .message-content {
            display: inline-block;
            padding: 10px;
            border-radius: 5px;
            max-width: 80%;
        }
        .input-group {
            padding: 10px;
            border-top: 1px solid #ccc;
        }
        .btn-send {
            background-color: #3daa3d;
            color: white;
        }
        .dropdown-menu {
            background-color: #5db15d; 
        }
        .chart-wrapper {
            width: 400px; 
            height: 200px; 
        }

    </style>
</head>
<body>
    <header class="bg-dark text-white text-center py-3">
        <div class="container">
            <h1>Terimbere</h1>
            <nav class="nav justify-content-center">
                <a class="nav-link text-white" href="/home">Home</a>
                <a class="nav-link text-white" href="/about">About</a>
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white" href="#" id="servicesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Services
                    </a>
                    <div class="dropdown-menu" aria-labelledby="servicesDropdown">
                        <a class="dropdown-item" href="/market">Market</a>
                        <a class="dropdown-item" href="/botanists">Botanists</a>
                        <a class="dropdown-item" href="/predictions">Predictions</a>
                    </div>
                </div>
                <a class="nav-link text-white" href="/login">Login</a>
                <a class="nav-link text-white" href="/signup">Signup</a>
            </nav>
        </div>
    </header>

    <section id="hero" class="bg-success text-white text-center py-5">
        <div class="container">
            <h2>Empowering Rwandan Smallholder Farmers</h2>
            <p>Providing resources, market access, and data-driven advice to boost productivity and income.</p>
            <a href="/about" class="btn btn-light">Learn More</a>
            <a href="#contact-form" class="btn btn-light">Contact Us</a>
        </div>
    </section>

    <section id="features" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">Key Features</h2>
            <div class="row">
                <div class="col-md-3">
                    <div class="card text-center h-100">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">Access to Resources</h5>
                            <p class="card-text flex-grow-1">Providing farmers with quality seeds, fertilizers, and modern farming equipment.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center h-100">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">Market Access</h5>
                            <p class="card-text flex-grow-1">Connecting farmers with markets to sell their produce at fair prices.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center h-100">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">Data-Driven Advice</h5>
                            <p class="card-text flex-grow-1">Offering personalized farming advice using machine learning.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center h-100">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">Financial Services</h5>
                            <p class="card-text flex-grow-1">Facilitating access to loans and investments.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="faq" class="bg-light py-5">
        <div class="container">
            <h2 class="text-center mb-5">Frequently Asked Questions</h2>
            <div class="accordion" id="faqAccordion">
                <div class="card">
                    <div class="card-header" id="faq1">
                        <h5 class="mb-0">
                            <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse1" aria-expanded="true" aria-controls="collapse1">
                                How can Terimbere help farmers?
                            </button>
                        </h5>
                    </div>
                    <div id="collapse1" class="collapse show" aria-labelledby="faq1" data-parent="#faqAccordion">
                        <div class="card-body">
                            By providing access to resources, market opportunities, and expert advice.
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header" id="faq2">
                        <h5 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse2" aria-expanded="false" aria-controls="collapse2">
                                What services does Terimbere offer?
                            </button>
                        </h5>
                    </div>
                    <div id="collapse2" class="collapse" aria-labelledby="faq2" data-parent="#faqAccordion">
                        <div class="card-body">
                            Resources, market access, financial services, and data-driven advice.
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header" id="faq3">
                        <h5 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse3" aria-expanded="false" aria-controls="collapse3">
                                How can investors participate?
                            </button>
                        </h5>
                    </div>
                    <div id="collapse3" class="collapse" aria-labelledby="faq3" data-parent="#faqAccordion">
                        <div class="card-body">
                            Investors can connect with farmers through the platform to provide loans and investments.
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header" id="faq4">
                        <h5 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse4" aria-expanded="false" aria-controls="collapse4">
                                Is there a cost for farmers to join?
                            </button>
                        </h5>
                    </div>
                    <div id="collapse4" class="collapse" aria-labelledby="faq4" data-parent="#faqAccordion">
                        <div class="card-body">
                            The platform aims to be accessible to all smallholder farmers.
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header" id="faq5">
                        <h5 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse5" aria-expanded="false" aria-controls="collapse5">
                                How is data security ensured?
                            </button>
                        </h5>
                    </div>
                    <div id="collapse5" class="collapse" aria-labelledby="faq5" data-parent="#faqAccordion">
                        <div class="card-body">
                            The platform uses encryption and regular security audits to protect user data.
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header" id="faq6">
                        <h5 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse6" aria-expanded="false" aria-controls="collapse6">
                                What makes Terimbere different from other platforms?
                            </button>
                        </h5>
                    </div>
                    <div id="collapse6" class="collapse" aria-labelledby="faq6" data-parent="#faqAccordion">
                        <div class="card-body">
                            Integration of machine learning for personalized advice and comprehensive support.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="impact-analysis" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">Impact Analysis</h2>
            <div class="row">
                <div class="col-md-6">
                    <h5>Impact on Farmers</h5>
                    <div class="chart-wrapper"><canvas id="impactChart"></canvas></div>
                </div>
                <div class="col-md-6">
                    <h5>Importance of Investments</h5>
                    <div class="chart-wrapper"><canvas id="investmentChart"></canvas></div>
                </div>
            </div>
        </div>
    </section>

    <section id="contact-form" class="bg-light py-5">
        <div class="container">
            <h2 class="text-center mb-5">Get in Touch</h2>
            <form action="/submit-contact" method="POST" class="w-50 mx-auto">
                <div class="form-group">
                    <label for="name">Name:</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="message">Message:</label>
                    <textarea class="form-control" id="message" name="message" rows="4" required></textarea>
                </div>
                <button type="submit" class="btn btn-success btn-block">Send Message</button>
            </form>
        </div>
    </section>

    <!-- Chatbot Container -->
    <div class="chatbot-container">
        <div class="chatbot-header" id="chatbotToggle">
            Chat with us
        </div>
        <div class="chatbot-body" id="chatbotBody">
            <div class="chatbox">
                <div class="messages" id="chatMessages">
                    <!-- Messages will appear here -->
                </div>
                <div class="input-group mt-3">
                    <input type="text" class="form-control" id="chatInput" placeholder="Type your message...">
                    <div class="input-group-append">
                        <button class="btn btn-send" type="button" id="sendBtn">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-3">
        <p>&copy; 2024 Terimbere. All rights reserved.</p>
    </footer>

    <script>
        document.getElementById('chatbotToggle').addEventListener('click', function() {
            var chatbotBody = document.getElementById('chatbotBody');
            if (chatbotBody.style.display === 'none' || chatbotBody.style.display === '') {
                chatbotBody.style.display = 'block';
            } else {
                chatbotBody.style.display = 'none';
            }
        });

        async function sendMessage(message) {
            const response = await fetch('/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: message })
            });
            const data = await response.json();
            console.log('Data:', data); // Log the data received from the server
            return data.response;
        }

        // Example usage:
        sendMessage('Hello, how are you?').then(response => {
            console.log('Response:', response); // This should log the response content
        }).catch(error => {
            console.error('Error:', error);
        });

        document.getElementById('sendBtn').addEventListener('click', async function() {
            var chatInput = document.getElementById('chatInput');
            var message = chatInput.value.trim();
            if (message !== '') {
                var userMessageElement = document.createElement('div');
                userMessageElement.classList.add('message', 'user');
                userMessageElement.innerHTML = '<div class="message-content">' + message + '</div>';
                document.getElementById('chatMessages').appendChild(userMessageElement);

                chatInput.value = '';
                chatInput.focus();

                var botReply = await sendMessage(message);

                var botMessageElement = document.createElement('div');
                botMessageElement.classList.add('message', 'bot');
                botMessageElement.innerHTML = '<div class="message-content">' + botReply + '</div>';
                document.getElementById('chatMessages').appendChild(botMessageElement);

                document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
            }
        });

        document.querySelector('.dropdown-toggle').addEventListener('click', function(event) {
            event.preventDefault(); // Prevent default action
            var dropdownMenu = this.nextElementSibling;
            dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
        });

    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        var ctxImpact = document.getElementById('impactChart').getContext('2d');
            var impactChart = new Chart(ctxImpact, {
                type: 'doughnut',
                data: {
                    labels: ['Increased Yield', 'Reduced Costs', 'Market Access', 'Financial Support'],
                    datasets: [{
                        data: [40, 20, 25, 15],
                        backgroundColor: ['#3daa3d', '#5cb85c', '#5bc0de', '#d9534f'],
                        borderColor: ['#fff', '#fff', '#fff', '#fff'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            enabled: true
                        }
                    }
                }
            });

            var ctxInvestment = document.getElementById('investmentChart').getContext('2d');
            var investmentChart = new Chart(ctxInvestment, {
                type: 'line',
                data: {
                    labels: ['2019', '2020', '2021', '2022', '2023'],
                    datasets: [{
                        label: 'Investment Impact on Production',
                        data: [50, 75, 90, 115, 130],
                        backgroundColor: 'rgba(93, 177, 93, 0.5)',
                        borderColor: '#5cb85c',
                        fill: true,
                        borderWidth: 2,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Production Increase (%)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Year'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            enabled: true
                        }
                    }
                }
            });

    </script>
    <!-- Ensure jQuery is included before Bootstrap's JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
